[返回上一级](./docs/Knowledge/计算机网络/README.md)

TCP篇

[1、TCP 头格式](#_31-tcp-头格式)

[2、为什么需要 TCP 协议？ TCP ⼯作在哪⼀层？](#_32-为什么需要-tcp-协议？-tcp-⼯作在哪⼀层？)



[3、什么是TCP？](#_33-什么是tcp)





[4、什么是 TCP 连接？](#_34-什么是-tcp-连接？)


[5、如何唯⼀确定⼀个 TCP 连接呢？](#_35-如何唯⼀确定⼀个-tcp-连接呢？)

[6、有⼀个 IP 的服务器监听了⼀个端⼝，它的 TCP 的最⼤连接数是多少？](#_36-有⼀个-ip-的服务器监听了⼀个端⼝，它的-tcp-的最⼤连接数是多少？)



[7、UDP 和 TCP 有什么区别呢？分别的应⽤场景是？](#_37-udp-和-tcp-有什么区别呢？分别的应⽤场景是？)

[8、为什么 UDP 头部没有「⾸部⻓度」字段，⽽ TCP 头部有「⾸部⻓度」字段呢？](#_38-为什么-udp-头部没有「⾸部⻓度」字段，⽽-tcp-头部有「⾸部⻓度」字段呢？)


[9、为什么 UDP 头部有「包⻓度」字段，⽽ TCP 头部则没有「包⻓度」字段呢？](#_39-为什么-udp-头部有「包⻓度」字段，⽽-tcp-头部则没有「包⻓度」字段呢？)

[10、 TCP 三次握⼿过程和状态变迁](#_310-tcp-三次握⼿过程和状态变迁)

[11、如何在 Linux 系统中查看 TCP 状态？](#_311-如何在-linux-系统中查看-tcp-状态？)




[12、为什么是三次握⼿？不是两次、四次？？](#_312-为什么是三次握⼿？不是两次、四次？)


[13、为什么是三次握⼿？不是两次、四次？小结？](#_313-为什么是三次握⼿？不是两次、四次？小结)


[14、TCP/IP ⽹络模型？](#_314-为什么客户端和服务端的初始序列号-isn-是不相同的？)

初始序列号 ISN 是如何随机产⽣的？
[15、为什么客户端和服务端的初始序列号 ISN 是不相同的？](#_315-初始序列号-isn-是如何随机产⽣的？)


[16既然 IP 层会分⽚，为什么 TCP 层还需要 MSS 呢？](#_316-既然-ip-层会分⽚，为什么-tcp-层还需要-mss-呢？)


[17、什么是 SYN 攻击？如何避免 SYN 攻击？](#_317-什么是-syn-攻击？如何避免-syn-攻击？)


[18、TCP 四次挥⼿过程和状态变迁](#_318-tcp-四次挥⼿过程和状态变迁)



[19、为什么挥⼿需要四次？？](#_319-为什么挥⼿需要四次？)





[20、为什么 TIME_WAIT 等待的时间是 2MSL？](#_320-为什么-time_wait-等待的时间是-2msl？)


[21、为什么需要 TIME_WAIT 状态？](#_321-为什么需要-time_wait-状态？)


[22、TIME_WAIT 过多有什么危害？](#_322-time_wait-过多有什么危害？)


[23、如何优化 TIME_WAIT？](#_323-如何优化-time_wait？)


[24、如果已经建⽴了连接，但是客户端突然出现故障了怎么办？](#_324-如果已经建⽴了连接，但是客户端突然出现故障了怎么办？)


[25、针对TCP应该如何Socket编程？](#325-针对tcp应该如何socket编程？)


[26、listen 时候参数 backlog 的意义？](#_326-listen-时候参数-backlog-的意义？)



[27、 accept 发⽣在三次握⼿的哪⼀步？](#_327-accept-发⽣在三次握⼿的哪⼀步？)


[28、客户端调⽤ close 了，连接是断开的流程是什么？](#_328-客户端调⽤-close-了，连接是断开的流程是什么？)




[29、为了⽅便调试服务器程序，⼀般会在服务端设置 SO_REUSEADDR 选项，这样服务器程序在启后，可以⽴刻使⽤。这⾥设置SO_REUSEADDR 是不是就等价于对这个 socket 设置了内核中的net.ipv4.tcp_tw_reuse=1 这个选项？”](#_329-为了⽅便调试服务器程序，⼀般会在服务端设置-so_reuseaddr-选项，这样服务器程序在启后，可以⽴刻使⽤。这⾥设置so_reuseaddr-是不是就等价于对这个-socket-设置了内核中的netipv4tcp_tw_reuse1-这个选项？)



[30、如果客户端第四次挥⼿ack丢失，服务端超时重发的fin报⽂也丢失，客户端timewait时间超过了2msl，这个时候会发⽣什么？认为连接已经关闭吗？”](#TCP/IP⽹络模型)



[31、⽂章在解释IP分⽚和TCP MSS分⽚时说，如果⽤IP分⽚会有两个问题：（1）IP按MTU分⽚，如果某⼀⽚丢失则需要所有分⽚都重传；（2）IP没有重传机制，所以需要等TCP发送⽅超时才能重传；问题⼀：MSS跟IP的MTU分⽚相⽐，只是多了⼀步协商MSS值的过程，⽽IP的MTU可以看作是默认协商好就是1500字节，所以为什么协商后的MSS可以做到丢失后只发丢失的这⼀⽚来提⾼效率，⽽默认协商好1500字节的IP分⽚就需要所有⽚都重传呢？问题⼆：TCP MSS分⽚如果丢失了⼀⽚，是不是也需要发送⽅等待超时再重传？如果不是，MSS的协商如何能在超时前就直到丢了分⽚从⽽提⾼效率的呢？](#_331-⽂章在解释ip分⽚和tcp-mss分⽚时说，如果⽤ip分⽚会有两个问题：（1）ip按mtu分⽚，如果某⼀⽚丢失则需要所有分⽚都重传；（2）ip没有重传机制，所以需要等tcp发送⽅超时才能重传；问题⼀：mss跟ip的mtu分⽚相⽐，只是多了⼀步协商mss值的过程，⽽ip的mtu可以看作是默认协商好就是1500字节，所以为什么协商后的mss可以做到丢失后只发丢失的这⼀⽚来提⾼效率，⽽默认协商好1500字节的ip分⽚就需要所有⽚都重传呢？问题⼆：tcp-mss分⽚如果丢失了⼀⽚，是不是也需要发送⽅等待超时再重传？如果不是，mss的协商如何能在超时前就直到丢了分⽚从⽽提⾼效率的呢？)



[32、如果是服务提供⽅发起的 close ，然后引起过多的 time_wait 状态的 tcp 链接，time_wait 会影响服务端的端⼝吗？](#_332-如果是服务提供⽅发起的-close-，然后引起过多的-time_wait-状态的-tcp-链接，time_wait-会影响服务端的端⼝吗？)



[33、重传机制](#_333-重传机制)


[34、滑动窗⼝](#_334-滑动窗⼝)



[35、窗⼝⼤⼩由哪⼀⽅决定？](#_335-窗⼝⼤⼩由哪⼀⽅决定？)



[36、发送⽅的滑动窗⼝](#_336-发送⽅的滑动窗⼝)





[37、程序是如何表示发送⽅的四个部分的呢？](#_337-程序是如何表示发送⽅的四个部分的呢？)


[38、接收⽅的滑动窗⼝？](#_338-接收⽅的滑动窗⼝)


[39、接收窗⼝和发送窗⼝的⼤⼩是相等的吗？？](#_339-接收窗⼝和发送窗⼝的⼤⼩是相等的吗？)


[40、流量控制？](#_340-流量控制)


[41、窗⼝关闭潜在的危险？](#_341-窗⼝关闭潜在的危险)

 
[42、TCP 是如何解决窗⼝关闭时，潜在的死锁现象呢？](#_342-tcp-是如何解决窗⼝关闭时，潜在的死锁现象呢？)


[43、怎么让接收⽅不通告⼩窗⼝呢？](#_343-怎么让接收⽅不通告⼩窗⼝呢？)


[44、怎么让发送⽅避免发送⼩数据呢？](#_344-怎么让发送⽅避免发送⼩数据呢？)


[45、为什么要有拥塞控制呀，不是有流量控制了吗？](#TCP/IP⽹络模型)


[46、什么是拥塞窗⼝？和发送窗⼝有什么关系呢？](#TCP/IP⽹络模型)


[47、那么怎么知道当前⽹络是否出现了拥塞呢？](#TCP/IP⽹络模型)




[48、拥塞控制有哪些控制算法？](#TCP/IP⽹络模型)





[49、TCP 实战抓包分析？](#TCP/IP⽹络模型)


[50、tcpdump 和 Wireshark 有什么区别？](#TCP/IP⽹络模型)


[51、 tcpdump 在 Linux 下如何抓包？](#TCP/IP⽹络模型)


[52、Wireshark ⼯具如何分析数据包？](#TCP/IP⽹络模型)



[53、解密 TCP 三次握⼿和四次挥⼿？](#TCP/IP⽹络模型)




[54、为什么三次握⼿连接过程的 Seq 是 0 ？](#TCP/IP⽹络模型)



[55、为什么抓到的 TCP 挥⼿是三次，⽽不是书上说的四次？？](#TCP/IP⽹络模型)


[56、 TCP 三次握⼿异常情况实战分析](#TCP/IP⽹络模型)



[57、咦？客户端设置了防⽕墙，屏蔽了服务端的⽹络包，为什么 tcpdump 还能抓到服务端的⽹络包？](#TCP/IP⽹络模型)



[58、tcp_syn_retries 是限制 SYN 重传次数，那第⼆次握⼿ SYN、ACK 限制最⼤重传次数是多少？](#TCP/IP⽹络模型)



[59、TCP 第⼀次握⼿的 SYN 包超时重传最⼤次数是由 tcp_syn_retries 指定，TCP 第⼆次握⼿的 SYN、ACK 包超时重传最⼤次数是由 tcp_synack_retries 指定，那 TCP 建⽴连接后的数据包最⼤超时重传次数是由什么参数指定呢？](#TCP/IP⽹络模型)



[60、那如果客户端不发送数据，什么时候才会断开处于 ESTABLISHED 状态的连接？](#TCP/IP⽹络模型)





[61、TCP 快速建⽴连接](#TCP/IP⽹络模型)


[62、在 Linux 上如何打开 Fast Open 功能？](#TCP/IP⽹络模型)


[63、TCP Fast Open 抓包分析](#TCP/IP⽹络模型)


[64、TCP 重复确认和快速重传](#TCP/IP⽹络模型)


[65、TCP 流量控制？](#TCP/IP⽹络模型)


[66、在 Wireshark 看到的 Windows size 也就是 " win = "，这个值表示发送窗⼝吗？](#TCP/IP⽹络模型)


[67、如何在包⾥看出发送窗⼝的⼤⼩？](#TCP/IP⽹络模型)


[68、发送窗⼝和 MSS 有什么关系？](#TCP/IP⽹络模型)


[69、发送⽅在⼀个窗⼝发出 n 个包，是不是需要 n 个 ACK 确认报⽂？？](#TCP/IP⽹络模型)



[70、TCP 延迟确认与 Nagle 算法](#TCP/IP⽹络模型)


[71、Nagle 算法是如何避免⼤量 TCP ⼩数据报⽂的传输？](#TCP/IP⽹络模型)


[72、那延迟确认⼜是什么？](#TCP/IP⽹络模型)



[73、延迟确认 和 Nagle 算法混合使⽤时，会产⽣新的问题](#TCP/IP⽹络模型)



[74、tcp_retries1 参数，是什么场景下⽣效？tcp_retries2是不是只受限于规定的次数，还是受限于次数和时间限制的最⼩值？”](#TCP/IP⽹络模型)


[75、tcp_orphan_retries也是控制tcp连接的关闭。这个跟tcp_retries1 tcp_retries2有什么区别吗？](#TCP/IP⽹络模型)


[76、请问，为什么连续两个报⽂的seq会是⼀样的呢，⽐如三次握⼿之后的那个报⽂？还是说，序号相同的是同⼀个报⽂，只是拆开显示了？](#TCP/IP⽹络模型)



[77、TCP 半连接队列和全连接队列？](#TCP/IP⽹络模型)


[78、在 TCP 三次握⼿的时候，Linux 内核会维护两个队列，分别是：？](#TCP/IP⽹络模型)



[79、实战 - TCP 全连接队列溢出之如何知道应⽤程序的 TCP 全连接队列⼤⼩？](#TCP/IP⽹络模型)


[80、如何模拟 TCP 全连接队列溢出的场景？](#TCP/IP⽹络模型)



[81、Linux 有个参数可以指定当 TCP 全连接队列满了会使⽤什么策略来回应客户端。？](#TCP/IP⽹络模型)


[82、如何增⼤ TCP 全连接队列呢？](#TCP/IP⽹络模型)


[83、增⼤ TCP 全连接队列后，继续压测？](#TCP/IP⽹络模型)


[84、实战 - TCP 半连接队列溢出之如何查看 TCP 半连接队列⻓度？](#TCP/IP⽹络模型)


[85、如何模拟 TCP 半连接队列溢出场景？？](#TCP/IP⽹络模型)


[86、⼤部分⼈都说 tcp_max_syn_backlog 是指定半连接队列的⼤⼩，是真的吗？？](#TCP/IP⽹络模型)


[85、半连接队列最⼤值 max_qlen_log 就表示服务端处于 SYN_REVC 状态的最⼤个数吗？？](#TCP/IP⽹络模型)


[85、每个 Linux 内核版本「理论」半连接最⼤值计算⽅式会不同？](#TCP/IP⽹络模型)


[85、如果 SYN 半连接队列已满，只能丢弃连接吗？？](#TCP/IP⽹络模型)



[85、如何防御 SYN 攻击？](#TCP/IP⽹络模型)



[85、读者问：“syncookies 启⽤后就不需要半链接了？那请求的数据会存在哪⾥？”](#TCP/IP⽹络模型)



[85、TCP 内核参数？](#TCP/IP⽹络模型)


[85、TCP 三次握⼿的性能提升？](#TCP/IP⽹络模型)


[85、如何查看由于 SYN 半连接队列已满，⽽被丢弃连接的情况？](#TCP/IP⽹络模型)



[85、如何调整 SYN 半连接队列⼤⼩？](#TCP/IP⽹络模型)



[85、如果 SYN 半连接队列已满，只能丢弃连接吗？](#TCP/IP⽹络模型)



[85、SYN_RCV 状态的优化](#TCP/IP⽹络模型)



[85、accept 队列已满，只能丢弃连接吗？](#TCP/IP⽹络模型)


[85、如何调整 accept 队列的⻓度呢？](#TCP/IP⽹络模型)


[85、如何查看服务端进程 accept 队列的⻓度？](#TCP/IP⽹络模型)



[85、如何查看由于 accept 连接队列已满，⽽被丢弃的连接？](#TCP/IP⽹络模型)


[85、如何绕过三次握⼿？](#TCP/IP⽹络模型)


[85、TCP Fast Open 功能的⼯作⽅式?](#TCP/IP⽹络模型)



[85、Linux 下怎么打开 TCP Fast Open 功能呢？](#TCP/IP⽹络模型)

[85、优化策略总结](#TCP/IP⽹络模型)

[85、TCP 四次挥⼿的性能提升](#TCP/IP⽹络模型)

[85、主动⽅的优化](#TCP/IP⽹络模型)

[85、被动⽅的优化](#TCP/IP⽹络模型)

[85、小结 TCP 四次挥⼿的优化](#TCP/IP⽹络模型)


[85、TCP 传输数据的性能提升？](#TCP/IP⽹络模型)


[85、小结TCP优化数据传输的方式](#TCP/IP⽹络模型)

[85、如果 accept 队列满了，那么 server 扔掉 client 发过来的 ack”，也就是说该TCP连接还是位于半连接队列中，没有丢弃吗？”？](#TCP/IP⽹络模型)
